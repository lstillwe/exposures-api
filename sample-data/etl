# Sample data from CMAQ: sample_cmaq_output.csv
# load sample_cmaq_output.csv to backend container:
# From the datatranslator directory
docker run -d --name backend backend
docker cp sample-data/sample_cmaq_output.csv backend:/sample_cmaq_output.csv

# from backend container
docker exec -ti backend /bin/bash
gosu postgres psql
CREATE USER datatrans WITH PASSWORD 'yourpassword';
CREATE DATABASE bdtgreen;
GRANT ALL PRIVILEGES ON DATABASE "bdtgreen" TO datatrans;
CREATE EXTENSION postgis;
CREATE EXTENSION postgis_topology;
CREATE EXTENSION ogr_fdw;
\c bdtgreen

create temp table tmp (
    ID text,
    COL text,
    ROW text,
    DATE text,
    HOUR text,
    O3 text,
    PM25_PRIMARY text,
    PM25_SECONDARY text
);
copy tmp from '/sample_cmaq_output.csv' delimiter ',' csv header;

create table cmaq (
    ID text,
    COL integer,
    ROW integer,
    DATE date, HOUR time,
    O3 float,
    PM25_PRIMARY float,
    PM25_SECONDARY float
);

INSERT INTO cmaq (ID, COL, ROW, DATE, HOUR, O3, PM25_PRIMARY, PM25_SECONDARY)
SELECT
    ID,
    cast(COL as integer),
    cast(ROW as integer),
    to_date(DATE, 'YYYYMMDD'),
    to_timestamp(cast((cast(HOUR as integer)/10000) as text), 'HH24'),
    cast(O3 as float),
    cast(PM25_PRIMARY as float),
    cast(PM25_SECONDARY as float)
FROM tmp;

drop table tmp;
select * from cmaq;